{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _classPrivateFieldLooseBase2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseBase\"));\n\nvar _classPrivateFieldLooseKey2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseKey\"));\n\nvar _util = require(\"@polkadot/util\"); // Copyright 2017-2020 @polkadot/api authors & contributors\n// This software may be modified and distributed under the terms\n// of the Apache-2.0 license. See the LICENSE file for details.\n\n\nclass Combinator {\n  constructor(fns, callback) {\n    Object.defineProperty(this, _allHasFired, {\n      writable: true,\n      value: false\n    });\n    Object.defineProperty(this, _callback, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _fired, {\n      writable: true,\n      value: []\n    });\n    Object.defineProperty(this, _fns, {\n      writable: true,\n      value: []\n    });\n    Object.defineProperty(this, _isActive, {\n      writable: true,\n      value: true\n    });\n    Object.defineProperty(this, _results, {\n      writable: true,\n      value: []\n    });\n    Object.defineProperty(this, _subscriptions, {\n      writable: true,\n      value: []\n    });\n    (0, _classPrivateFieldLooseBase2.default)(this, _callback)[_callback] = callback; // eslint-disable-next-line @typescript-eslint/require-await\n\n    (0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions] = fns.map(async (input, index) => {\n      const [fn, ...args] = Array.isArray(input) ? input : [input];\n\n      (0, _classPrivateFieldLooseBase2.default)(this, _fired)[_fired].push(false);\n\n      (0, _classPrivateFieldLooseBase2.default)(this, _fns)[_fns].push(fn); // Not quite 100% how to have a variable number at the front here\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return,@typescript-eslint/ban-types\n\n\n      return fn(...args, this._createCallback(index));\n    });\n  }\n\n  _allHasFired() {\n    if (!(0, _classPrivateFieldLooseBase2.default)(this, _allHasFired)[_allHasFired]) {\n      (0, _classPrivateFieldLooseBase2.default)(this, _allHasFired)[_allHasFired] = (0, _classPrivateFieldLooseBase2.default)(this, _fired)[_fired].filter(hasFired => !hasFired).length === 0;\n    }\n\n    return (0, _classPrivateFieldLooseBase2.default)(this, _allHasFired)[_allHasFired];\n  }\n\n  _createCallback(index) {\n    return value => {\n      (0, _classPrivateFieldLooseBase2.default)(this, _fired)[_fired][index] = true;\n      (0, _classPrivateFieldLooseBase2.default)(this, _results)[_results][index] = value;\n\n      this._triggerUpdate();\n    };\n  }\n\n  _triggerUpdate() {\n    if (!(0, _classPrivateFieldLooseBase2.default)(this, _isActive)[_isActive] || !(0, _util.isFunction)((0, _classPrivateFieldLooseBase2.default)(this, _callback)[_callback]) || !this._allHasFired()) {\n      return;\n    }\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      (0, _classPrivateFieldLooseBase2.default)(this, _callback)[_callback]((0, _classPrivateFieldLooseBase2.default)(this, _results)[_results]);\n    } catch (error) {// swallow, we don't want the handler to trip us up\n    }\n  }\n\n  unsubscribe() {\n    if (!(0, _classPrivateFieldLooseBase2.default)(this, _isActive)[_isActive]) {\n      return;\n    }\n\n    (0, _classPrivateFieldLooseBase2.default)(this, _isActive)[_isActive] = false; // eslint-disable-next-line @typescript-eslint/no-misused-promises\n\n    (0, _classPrivateFieldLooseBase2.default)(this, _subscriptions)[_subscriptions].forEach(async subscription => {\n      try {\n        const unsubscribe = await subscription;\n\n        if ((0, _util.isFunction)(unsubscribe)) {\n          unsubscribe();\n        }\n      } catch (error) {// ignore\n      }\n    });\n  }\n\n}\n\nexports.default = Combinator;\n\nvar _allHasFired = (0, _classPrivateFieldLooseKey2.default)(\"allHasFired\");\n\nvar _callback = (0, _classPrivateFieldLooseKey2.default)(\"callback\");\n\nvar _fired = (0, _classPrivateFieldLooseKey2.default)(\"fired\");\n\nvar _fns = (0, _classPrivateFieldLooseKey2.default)(\"fns\");\n\nvar _isActive = (0, _classPrivateFieldLooseKey2.default)(\"isActive\");\n\nvar _results = (0, _classPrivateFieldLooseKey2.default)(\"results\");\n\nvar _subscriptions = (0, _classPrivateFieldLooseKey2.default)(\"subscriptions\");","map":null,"metadata":{},"sourceType":"script"}