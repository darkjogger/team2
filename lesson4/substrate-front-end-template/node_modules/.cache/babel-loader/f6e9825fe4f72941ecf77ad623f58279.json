{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = getUniqTypes;\n\nvar _flattenUniq = _interopRequireDefault(require(\"./flattenUniq\"));\n\nvar _validateTypes = _interopRequireDefault(require(\"./validateTypes\")); // Copyright 2017-2020 @polkadot/metadata authors & contributors\n// This software may be modified and distributed under the terms\n// of the Apache-2.0 license. See the LICENSE file for details.\n\n/** @internal */\n\n\nfunction unwrapCalls(mod) {\n  return mod.calls ? mod.calls.unwrapOr([]) // V0\n  : mod.module ? mod.module.call.functions : [];\n}\n/** @internal */\n\n\nfunction getCallNames({\n  modules\n}) {\n  return modules.map(mod => unwrapCalls(mod).map(({\n    args\n  }) => args.map(arg => arg.type.toString())));\n}\n/** @internal */\n\n\nfunction getConstantNames({\n  modules\n}) {\n  return modules.map(({\n    constants\n  }) => constants ? constants.map(constant => constant.type.toString()) : []);\n}\n/** @internal */\n\n\nfunction unwrapEvents(events) {\n  if (!events) {\n    return [];\n  }\n\n  return events.unwrapOr([]);\n}\n/** @internal */\n\n\nfunction getEventNames({\n  modules,\n  outerEvent\n}) {\n  const mapArg = ({\n    args\n  }) => args.map(arg => arg.toString()); // V0\n\n\n  if (outerEvent) {\n    return outerEvent.events.map(([, events]) => events.map(mapArg));\n  } // V1+\n\n\n  return modules.map(({\n    events\n  }) => unwrapEvents(events).map(mapArg));\n}\n/** @internal */\n\n\nfunction unwrapStorage(storage) {\n  if (!storage) {\n    return [];\n  }\n\n  const data = storage.unwrapOr([]);\n  return Array.isArray(data) ? data : data.items || data.functions;\n}\n/** @internal */\n\n\nfunction getStorageNames({\n  modules\n}) {\n  return modules.map(({\n    storage\n  }) => unwrapStorage(storage).map(({\n    type\n  }) => {\n    if (type.isDoubleMap && type.asDoubleMap) {\n      return [type.asDoubleMap.key1.toString(), type.asDoubleMap.key2.toString(), type.asDoubleMap.value.toString()];\n    } else if (type.isMap) {\n      return [type.asMap.key.toString(), type.asMap.value.toString()];\n    } else {\n      return [type.asPlain.toString()];\n    }\n  }));\n}\n/** @internal */\n\n\nfunction getUniqTypes(registry, meta, throwError) {\n  const types = (0, _flattenUniq.default)([getCallNames(meta), getConstantNames(meta), getEventNames(meta), getStorageNames(meta)]);\n  (0, _validateTypes.default)(registry, types, throwError);\n  return types;\n}","map":null,"metadata":{},"sourceType":"script"}