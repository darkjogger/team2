"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _classPrivateFieldLooseBase2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseBase"));

var _classPrivateFieldLooseKey2 = _interopRequireDefault(require("@babel/runtime/helpers/classPrivateFieldLooseKey"));

var _fs = _interopRequireDefault(require("fs"));

var _mkdirp = _interopRequireDefault(require("mkdirp"));

var _path2 = _interopRequireDefault(require("path"));

// Copyright 2017-2020 @polkadot/ui-keyring authors & contributors
// This software may be modified and distributed under the terms
// of the Apache-2.0 license. See the LICENSE file for details.
// NOTE untested and unused by any known apps, probably broken in various mysterious ways
class FileStore {
  constructor(path) {
    Object.defineProperty(this, _path, {
      writable: true,
      value: void 0
    });

    if (!_fs.default.existsSync(path)) {
      _mkdirp.default.sync(path);
    }

    (0, _classPrivateFieldLooseBase2.default)(this, _path)[_path] = path;
  }

  all(cb) {
    _fs.default.readdirSync((0, _classPrivateFieldLooseBase2.default)(this, _path)[_path]).filter(key => !['.', '..'].includes(key)).forEach(key => {
      cb(key, this._readKey(key));
    });
  }

  get(key, cb) {
    cb(this._readKey(key));
  }

  remove(key, cb) {
    _fs.default.unlinkSync(this._getPath(key));

    cb && cb();
  }

  set(key, value, cb) {
    _fs.default.writeFileSync(this._getPath(key), Buffer.from(JSON.stringify(value), 'utf-8'));

    cb && cb();
  }

  _getPath(key) {
    return _path2.default.join((0, _classPrivateFieldLooseBase2.default)(this, _path)[_path], key);
  }

  _readKey(key) {
    return JSON.parse(_fs.default.readFileSync(this._getPath(key)).toString('utf-8'));
  }

}

exports.default = FileStore;

var _path = (0, _classPrivateFieldLooseKey2.default)("path");